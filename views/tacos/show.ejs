<%- include('../partials/html-head') %>
<%- include('../partials/nav') %>

<section>
	<p>From the kitchen of <%= taco.owner.name %>...</p>
  <h1><%= taco.name %> ðŸŒ®</h1>
  <h2>This taco is <%= taco.tasty ? 'tasty! ðŸ˜‹' : 'not tasty! ðŸ˜«' %></h2>
	<% if (user) { %>
    <form action="/tacos/<%= taco._id %>/flip-tasty?_method=PATCH" method="POST">
      <button class="btn" type="submit">
        Make taco <%= taco.tasty ? 'not tasty ðŸŒ®ðŸ¥º' : 'tasty ðŸŒ®ðŸŽ‰' %>
      </button>
    </form>
  <% } %>
	<% if (taco.owner.equals(user?.profile._id)) { %>
    <a href="/tacos/<%= taco._id %>/edit">
      <button class="btn">Edit this Taco ðŸŒ®ðŸš§</button>
    </a>
    <form action="/tacos/<%= taco._id %>?_method=DELETE" method="POST">
      <button class="btn" type="submit">Delete this taco ðŸŒ®ðŸ’€</button>
    </form>
  <% } %>
  <h2>Comments</h2>
  <ul>
    <% taco.comments?.forEach(comment => { %>
      <li>
        <%= comment.content%> 
        - 
        <img 
          class="comment-photo" 
          src="<%= comment.author.avatar %>" 
          alt="avatar of commenter"
        > 
        <a href="/profiles/<%= comment.author._id %>">
          <%= comment.author.name %>
        </a> 
        at 
        <%= comment.createdAt.toLocaleString() %>
      </li>
    <% }) %>
  </ul>
  <% if (user) { %>
    <h3>Add a comment</h3>
    <form action="/tacos/<%= taco._id %>/comments" method="POST">
      <textarea name="content"></textarea><br>
      <button type="submit">Add Comment</button>
    </form>
  <% } %>
</section>

<%- include('../partials/footer') %>